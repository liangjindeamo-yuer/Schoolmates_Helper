{% extends 'base_main.html' %}
{% load  static %}
{% block ext_css %}
    {{ block.super }}
    {% if task.publisher.id != user.id and task.hunter.id != user.id or user.id == None %}
        <link rel="stylesheet" href="{% static 'Schoolmateshelper/main/css/alltask.css' %}"
              xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
    {% else %}
        <link rel="stylesheet" href="{% static 'Schoolmateshelper/main/css/mine.css' %}">
    {% endif %}
{% endblock %}
{% block ext_js %}
    {{ block.super }}
    {% if task.publisher.id != user.id and task.hunter.id != user.id %}
        <script type="text/javascript" src="{% static 'Schoolmateshelper/user/js/alltask.js' %}"></script>
    {% endif %}
    <script type="text/javascript" src="{% static 'Schoolmateshelper/user/js/alltask_hunter.js' %}"></script>
    <script type="text/javascript" src="{% static 'Schoolmateshelper/user/js/alltask_publisher.js' %}"></script>
    <script type="text/javascript" src="{% static 'Schoolmateshelper/user/js/taskcontent.js' %}"></script>
    <script type="text/javascript" src="{% static 'Schoolmateshelper/user/js/alltask.js' %}"></script>
{% endblock %}
{% block content %}
    <div style="position:relative;overflow: auto;height: 100%;padding: 1.5rem 0;">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">任务名称</h3>
            </div>
            <div class="panel-body">
                {{ task.task_name }}
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">任务详情</h3>
            </div>
            <div class="panel-body">
                {{ task.task_sketch }}
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">任务酬劳</h3>
            </div>
            <div class="panel-body">
                {{ task.task_reward }}
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">任务截止时间</h3>
            </div>
            <div class="panel-body">
                {{ task.task_date_year }}年 {{ task.task_date_month }}月 {{ task.task_date_day }}日
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">任务附件</h3>
            </div>
            <div class="panel-body">
                {% if task.task_file %}
                    <a href="http://{{ SERVER_HOST }}:{{ SERVER_PORT }}/static/uploads/{{ task.task_file }}"
                       download="任务附件">Download</a>
                {% else %}
                    无附件
                {% endif %}
            </div>
        </div>
        {% if is_login and task.publisher.id == user.id %}
            {% if task.is_finished %}
                {% if task.comment_publisher %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">发布者任务评价</h3>
                        </div>
                        <div class="panel-body">
                            {{ task.comment_publisher }}
                        </div>
                    </div>
                    {% if task.comment_hunter %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">接受者任务评价</h3>
                            </div>
                            <div class="panel-body">
                                {{ task.comment_hunter }}
                            </div>
                        </div>
                    {% else %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">接受者任务评价</h3>
                            </div>
                            <div class="panel-body">
                                暂无评价，请等待接受方填写
                            </div>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">发布者任务评价</h3>
                        </div>
                        <div class="panel-body">
                            暂无评价，请填写
                        </div>
                    </div>
                    <form style="margin-top:-0.4rem;" method="post" enctype="multipart/form-data"
                          action="{% url 'App:taskcontent' task.id %}"
                          onsubmit="return checktask()">
                        {% csrf_token %}
                        <div class="form-group">
                        <textarea rows="3" class="form-control" placeholder="请输入你对这次任务的评价"
                                  id="comment_input"
                                  name="comment"></textarea>
                            <span id="comment_info"></span>
                        </div>
                        <button type="submit" class="btn  btn-warning" style="margin-top: -0.3rem">发布评价</button>
                    </form>
                    {% if task.comment_hunter %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">接受者任务评价</h3>
                            </div>
                            <div class="panel-body">
                                {{ task.comment_hunter }}
                            </div>
                        </div>
                    {% else %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">接受者任务评价</h3>
                            </div>
                            <div class="panel-body">
                                暂无评价，等待接受方填写
                            </div>
                        </div>
                    {% endif %}
                {% endif %}
            {% elif task.is_pickedup == 0 %}
                <button class="btn btn-block btn-success" onclick="modifytask({{ task.id }})"
                        style="position: absolute;right:0.15rem;">修改任务
                </button>
            {% else %}
                <button class="btn btn-danger btn-block" onclick="relievetask({{ task.id }})"
                        style="position: absolute;right:0.15rem;">解除委托
                </button>
                <button class="btn btn-success btn-block" onclick="finishtask({{ task.id }})"
                        style="position: absolute;right:0.15rem;margin-top: 1.2rem">任务完成
                </button>
            {% endif %}
        {% elif is_login and task.hunter.id == user.id %}
            {% if task.is_finished %}
                {% if task.comment_hunter %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">接受者任务评价</h3>
                        </div>
                        <div class="panel-body">
                            {{ task.comment_hunter }}
                        </div>
                    </div>
                    {% if task.comment_publisher %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">发布者任务评价</h3>
                            </div>
                            <div class="panel-body">
                                {{ task.comment_publisher }}
                            </div>
                        </div>
                    {% else %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">发布者任务评价</h3>
                            </div>
                            <div class="panel-body">
                                暂无评价，等待接受方填写
                            </div>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">接受者任务评价</h3>
                        </div>
                        <div class="panel-body">
                            暂无评价，请填写
                        </div>
                    </div>
                    <form style="margin-top:-0.4rem;" method="post" enctype="multipart/form-data"
                          action="{% url 'App:taskcontent' task.id %}"
                          onsubmit="return checktask()">
                        {% csrf_token %}
                        <div class="form-group">
                        <textarea rows="3" class="form-control" placeholder="请输入你对这次任务的评价"
                                  id="comment_input"
                                  name="comment"></textarea>
                            <span id="comment_info"></span>
                        </div>
                        <button type="submit" class="btn  btn-warning" style="margin-top: -0.3rem">发布评价</button>
                    </form>
                    {% if task.comment_publisher %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">发布者任务评价</h3>
                            </div>
                            <div class="panel-body">
                                {{ task.comment_publisher }}
                            </div>
                        </div>
                    {% else %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">发布者任务评价</h3>
                            </div>
                            <div class="panel-body">
                                暂无评价，等待发布方填写
                            </div>
                        </div>
                    {% endif %}
                {% endif %}
            {% else %}
                <button class="btn btn-block btn-warning" onclick="relievetask2({{ task.id }})"
                        style="position: absolute;right:0.15rem;margin-top: 0.5rem">取消任务
                </button>
            {% endif %}
        {% else %}
            <button type="submit" onclick="on_click_alltask({{ task.id }},{{ is_login }})"
                    class="btn btn-block btn-success">接受任务
            </button>
        {% endif %}
    </div>


{% endblock %}
